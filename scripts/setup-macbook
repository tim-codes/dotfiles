#!/bin/zsh
set -o pipefail

source $HOME/.config/local.sh

# ~~~~ SETUP ~~~~ #
# ~~~~~~~~~~~~~~~ #

# create default zshrc file
touch ~/.zshrc

# install homebrew
if ! command -v /opt/homebrew/bin/brew &> /dev/null; then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo 'PATH="/opt/homebrew/bin:$PATH"' >> ~/.zshrc
    source ~/.zshrc
fi

$DOTFILES_ROOT/scripts/brew-update

# setup .config sync with stow
cd $DOTFILES_ROOT && stow --target $HOME src
cd -
# chsh -s $(which fish)

cat <<EOF | fish

# if ! type -q fisher
  echo "Installing fisher"
  curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source \
    && fisher install jorgebucaran/fisher
# end
# update/install fisher_plugins from file
fisher update

EOF

# install rust
if ! command -v rustup &> /dev/null; then
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --no-modify-path
  source $HOME/.cargo/env
fi

$DOTFILES_ROOT/scripts/cargo-update

# add fonts
$DOTFILES_ROOT/scripts/install-fonts-mac

# install alacritty terminal emulator
if ! command -v alacritty &> /dev/null; then
  $DOTFILES_ROOT/scripts/install-alacritty-mac
fi
